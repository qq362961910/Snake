<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tian An Men 3D</title>
    <script type="text/javascript" src="/web/static/js/three.js"></script>
    <script type="text/javascript" src="/web/static/js/MTLLoader.js"></script>
    <script type="text/javascript" src="/web/static/js/OBJLoader.js"></script>
    <style type="text/css">
        html {
            width: 100%;
            height: 100%;
        }
        body {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body id="htmlBody">
</body>
<script type="text/javascript">
    /**
     * 问题:
     * 1.设置window.innerWidth，window.innerHeight会多出一点滚动条
     * 2.加载玩mtl文件后执行的materials.preload();有什么作用
     *
     * */
</script>
<script type="text/javascript">
//定义常量
var rootPath = location.origin;
var OBJECTS_TO_LOAD = [
    {
        mtlPath: "/web/static/3d/tiananmen.mtl",
        objPath: "/web/static/3d/tiananmen.obj"
    }
];
</script>
<script type="text/javascript">
    var renderer;
    var scene;
    var camera;
    var axisHelper;
    var directWhiteLight;
    var directBlueLight;
    var directBlackLight;


    var init = function() {
        //1.初始化组建
        //渲染器
        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById("htmlBody").appendChild(renderer.domElement);
        //场景
        scene = new THREE.Scene();
        //相机
        camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 100000);
        //白色平行光照
        directWhiteLight = new THREE.DirectionalLight(0xffffff);
        directWhiteLight.position.set(1, 1, 1);
        scene.add(directWhiteLight);
        //蓝色平行光照
        directBlueLight = new THREE.DirectionalLight(0x002288);
        directBlueLight.position.set(-1, -1, -1);
        scene.add(directBlueLight);
        //黑色环境光照
        directBlackLight = new THREE.AmbientLight(0x222222);
        scene.add(directBlackLight);

        //坐标系
        axisHelper = new THREE.AxisHelper(7);
        scene.add(axisHelper);

        console.info("init component ok....");

        //2.添加物体
        //材质加载器,模型加载器
        var mtlLoader = new THREE.MTLLoader();
        var objLoader = new THREE.OBJLoader();
        for (var i=0; i<OBJECTS_TO_LOAD.length; i++) {
            var objJson = OBJECTS_TO_LOAD[i];
            mtlLoader.load(objJson.mtlPath, function(materials) {
                materials.preload();
                objLoader.setMaterials(materials);
                objLoader.load(objJson.objPath, function (object) {
                    object.traverse(function(child) {
                        if (child instanceof THREE.Mesh) {
                            child.material = new THREE.MeshLambertMaterial({
                                side: THREE.DoubleSide
                            });
                        }
                    });
                    scene.add(object);
                    var box= new THREE.Box3().setFromObject(object);
                    camera.position.set(box.getCenter().x, box.getCenter().y+3000, box.getCenter().z+10000 );
                    renderer.render(scene, camera);
                }, function () {
                    console.info("on progress....");
                }, function () {
                    console.info("on error");
                });
            });
        };
        //渲染
        renderer.render(scene, camera);
    }();



</script>
<script type="text/javascript">
    window.onresize = function() {
        renderer.render(scene, camera);
    }
</script>
</html>